NO2_umol.per.l=btl2_Nitrite.umol.kg.1,
NO3_umol.per.l=btl2_Nitrate.umol.kg.1,
NH4_umol.per.l =btl2_Ammonium.umol.kg.1) -> REVAMP_RC0083
REVAMP_RC0083
rbind(REVAMP_DY20_12, REVAMP_DY22_06, REVAMP_DY22_09, REVAMP_DY23_06, REVAMP_NO20_01, REVAMP_PPS_0523, REVAMP_RC0083, REVAMP_SKQ21_12S, REVAMP_SKQ23_12S) -> revamp_sample_metadata
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E1820"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E1820"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E1877"))
FinalOME_Merge_DY20_12 <- read.csv(file = here("data","1_SampleCollection","2020_Dyson_CruiseData","2020_Dyson_CruiseData","FinalOME_Merge_DY20-12.csv"), header=T)
FinalOME_Merge_NO20_01 <-  read.csv(here("data","1_SampleCollection","2020_Norseman_CruiseData","FinalOME_Merge_NO20-01.csv"), header=T)
FinalOME_Merge_SKQ21_12S <- read.csv(file = here("data","1_SampleCollection","2021_SikuliaqDBO_CruiseData","2021_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ21-12S.csv"), header=T)
FinalOME_Merge_DY22_09 <- read.csv(here("data","1_SampleCollection","2022_EcoFociFallMooring_CruiseData","FinalOME_Merge_DY22-09.csv"), header=T)
FinalOME_Merge_DY22_06 <- read.csv(here("data","1_SampleCollection","2022_EcoFociSpringMooring_CruiseData","FinalOME_Merge_DY22-06.csv"), header=T)
FinalOME_Merge_RC0083 <- read.csv(here("data","1_SampleCollection","2022_GOA-OA_CruiseData","FinalOME_Merge_RC0083.csv"), header=T)
FinalOME_Merge_DY23_06 <- read.csv(here("data","1_SampleCollection","2023_EcoFociSpringMooring_CruiseData","FinalOME_Merge_DY23-06.csv"), header=T)
FinalOME_Merge_M2_PPS_0523 <- read.csv(here("data","1_SampleCollection","2023_M2_Spring-Summer_CruiseData","FinalOME_Merge_M2-PPS-0523.csv"), header=T)
FinalOME_Merge_SKQ23_12S <- read.csv(here("data","1_SampleCollection","2023_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ23-12S.csv"), header=T)
FinalOME_Merge_SKQ23_12S %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= ctd_temperature_ch1..degree_C.,
PSU_ppt = ctd_salinity_ch1..PSU.,
OxySatPerc_percent = ctd_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = ctd_oxy_conc_ch1..umol.kg.,
Chla_ugrams.per.l = ctd_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_SKQ23_12S
rbind(REVAMP_DY20_12, REVAMP_DY22_06, REVAMP_DY22_09, REVAMP_DY23_06, REVAMP_NO20_01, REVAMP_PPS_0523, REVAMP_RC0083, REVAMP_SKQ21_12S, REVAMP_SKQ23_12S) -> revamp_sample_metadata
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E1877"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E1990"))
FinalOME_Merge_SKQ23_12S
FinalOME_Merge_SKQ23_12S %>%
mutate(., ctd_latitude..degrees_north. = if_else(is.na(ctd_latitude..degrees_north.), Lat_notes,ctd_latitude..degrees_north.)) %>%
mutate(., ctd_longitude..degrees_east. = if_else(is.na(ctd_longitude..degrees_east.), Lon_notes,ctd_longitude..degrees_east.)) %>%
mutate(., ctd_pressure = if_else(is.na(ctd_pressure), Depth_m_notes,ctd_pressure)) %>%
mutate(., ctd_time..UTC. = if_else(is.na(ctd_time..UTC.), str_c(Date_UTC_notes,"Z"),ctd_time..UTC.)) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.," ", "T")) %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= ctd_temperature_ch1..degree_C.,
PSU_ppt = ctd_salinity_ch1..PSU.,
OxySatPerc_percent = ctd_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = ctd_oxy_conc_ch1..umol.kg.,
Chla_ugrams.per.l = ctd_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_SKQ23_12S
REVAMP_SKQ23_12S %>%
filter(., is.na(Time))
rbind(REVAMP_DY20_12, REVAMP_DY22_06, REVAMP_DY22_09, REVAMP_DY23_06, REVAMP_NO20_01, REVAMP_PPS_0523, REVAMP_RC0083, REVAMP_SKQ21_12S, REVAMP_SKQ23_12S) -> revamp_sample_metadata
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E2084"))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E233"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace_all(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace_all(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,".PCR1|.PCR2|.PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E25"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_DY20",".DY20")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_DY20",".DY2012")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E26.1B"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_DY20",".DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"E26.1B.DY2012","E26.1B.NC.DY2012")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E44"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_DY20",".DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,".DY20",".DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"E26.1B.DY2012","E26.1B.NC.DY2012")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_DY20",".DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"E26.1B.DY2012","E26.1B.NC.DY2012")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_DY20",".DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"E26.1B.DY2012","E26.1B.NC.DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"E44.DY20","E44.DY2012")) %>%
left_join(revamp_sample_metadata) %>%
filter(., is.na(Time))
FinalOME_Merge_DY20_12 <- read.csv(file = here("data","1_SampleCollection","2020_Dyson_CruiseData","2020_Dyson_CruiseData","FinalOME_Merge_DY20-12.csv"), header=T)
FinalOME_Merge_DY20_12 <- read.csv(file = here("data","1_SampleCollection","2020_DY20-12_CruiseData","2020_Dyson_CruiseData","FinalOME_Merge_DY20-12.csv"), header=T)
library(tidyverse)
library(readxl)
library(here)
library(readr)
FinalOME_Merge_DY20_12 <- read.csv(file = here("data","1_SampleCollection","2020_DY20-12_CruiseData","2020_Dyson_CruiseData","FinalOME_Merge_DY20-12.csv"), header=T)
FinalOME_Merge_NO20_01 <-  read.csv(here("data","1_SampleCollection","2020_Norseman_CruiseData","FinalOME_Merge_NO20-01.csv"), header=T)
FinalOME_Merge_NO20_01 <-  read.csv(here("data","1_SampleCollection","2020_NO20-01_CruiseData","FinalOME_Merge_NO20-01.csv"), header=T)
FinalOME_Merge_SKQ21_12S <- read.csv(file = here("data","1_SampleCollection","2021_SikuliaqDBO_CruiseData","2021_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ21-12S.csv"), header=T)
FinalOME_Merge_DY22_09 <- read.csv(here("data","1_SampleCollection","2022_EcoFociFallMooring_CruiseData","FinalOME_Merge_DY22-09.csv"), header=T)
FinalOME_Merge_DY22_09 <- read.csv(here("data","1_SampleCollection","2022_DY22-09_CruiseData","FinalOME_Merge_DY22-09.csv"), header=T)
FinalOME_Merge_DY22_06 <- read.csv(here("data","1_SampleCollection","2022_DY22-06_CruiseData","FinalOME_Merge_DY22-06.csv"), header=T)
FinalOME_Merge_RC0083 <- read.csv(here("data","1_SampleCollection","2022_GOA-OA_CruiseData","FinalOME_Merge_RC0083.csv"), header=T)
FinalOME_Merge_DY23_06 <- read.csv(here("data","1_SampleCollection","2023_EcoFociSpringMooring_CruiseData","FinalOME_Merge_DY23-06.csv"), header=T)
FinalOME_Merge_M2_PPS_0523 <- read.csv(here("data","1_SampleCollection","2023_M2_Spring-Summer_CruiseData","FinalOME_Merge_M2-PPS-0523.csv"), header=T)
FinalOME_Merge_SKQ23_12S <- read.csv(here("data","1_SampleCollection","2023_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ23-12S.csv"), header=T)
FinalOME_Merge_AquaM_23 <- read.csv(here("data","1_SampleCollection","2023_aquamonitor_CruiseData","FinalOME_Merge_AquaM_23.csv"), header=T)
run1_4_revamp_formatted_metadata.csv <- read.csv(run1_4_revamp_formatted_metadata)
run1_4_revamp_formatted_metadata.csv <- read.csv(here("run1_4_revamp_formatted_metadata.csv"))
library(here)
library(tidyverse)
run1_4_revamp_formatted_metadata.csv <- read.csv(here("run1_4_revamp_formatted_metadata.csv"))
run1_4_revamp_formatted_metadata.csv
here()
run3_18Sv4_asv <- read.csv(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv4_REVAMP_out","dada2","ASVs_counts.tsv"))
run3_18Sv4_asv
run3_18Sv4_asv <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv4_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t")
run3_18Sv4_asv
run3_18Sv4_asv <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv4_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t", header=T)
run3_18Sv4_asv
run3_18Sv4_asv <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv4_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run3_18Sv4_asv
run3_18Sv4_tax <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv4_REVAMP_out","dada2","18Sv4_REVAMP_out_asvTaxonomyTable.txt"), sep="\t", header=T)
run3_18Sv4_tax <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv4_REVAMP_out","ASV2Taxonomy","18Sv4_REVAMP_out_asvTaxonomyTable.txt"), sep="\t", header=T)
run3_18Sv4_tax
run3_18Sv4_asv %>%
left_join(run3_18Sv4_tax)
run3_18Sv4_asv %>%
left_join(run3_18Sv4_tax) %>%
rename_all(stringr::str_replace_all(., 'MP_', ''))
run3_18Sv4_asv %>%
left_join(run3_18Sv4_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", "")))
run1_4_revamp_formatted_metadata.csv
run1_4_revamp_formatted_metadata <- read.csv(here("run1_4_revamp_formatted_metadata.csv"))
run1_4_revamp_formatted_metadata
run1_4_revamp_formatted_metadata %>%
filter(., Sample=="E25_2B_DY20")
run3_18Sv4_asv %>%
left_join(run3_18Sv4_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run3_18Sv4_merge
run3_18Sv4_merge
colnames(run3_18Sv4_merge)
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads")
run1_4_revamp_formatted_metadata
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., is.na(group1))
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., is.na(group1)) %>%
dplyr::select(Sample) %>%  distinct()
run1_4_revamp_formatted_metadata %>%
filter(., str_detect(Sample, "E24"))
run1_4_revamp_formatted_metadata %>%
filter(., str_detect(Sample, "E24_"))
run1_4_revamp_formatted_metadata %>%
filter(., str_detect(Sample, "E24"))
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) -> run3_18Sv4_long
~/Documents/UCLA_download_20240702/combined/Takeout/Drive/Unorganized/eDNA_index.r
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
group_by(Sample, ASV) %>%
summarise(sumreads = sum(nReads)) %>%
group_by(Sample) %>%
mutate (Tot = sum(sumreads),
Row.prop = sumreads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max (Row.prop),
eDNA.Index = Row.prop / Colmax) %>%  head()
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Row.prop = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Row.prop),
eDNA.Index = Row.prop / Colmax) %>%  head()
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-sumreads,-Colmax) -> run3_18Sv4_long
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run3_18Sv4_long
run3_18Sv4_long
run1_4_revamp_formatted_metadata
run3_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>%
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run3_18Sv4_long
run3_18Sv4_long
run2_18Sv4_asv <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","18Sv4_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run2_18Sv4_asv <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","18Sv4","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run2_18Sv4_tax <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","18Sv4","ASV2Taxonomy","18Sv4_REVAMP_out_asvTaxonomyTable.txt"), sep="\t", header=T)
run2_18Sv4_tax <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","18Sv4","ASV2Taxonomy","18Sv4_asvTaxonomyTable.txt"), sep="\t", header=T)
run2_18Sv4_tax <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","18Sv4","ASV2Taxonomy","18Sv4_RUN1_asvTaxonomyTable.txt"), sep="\t", header=T)
run2_18Sv4_asv
run2_18Sv4_tax
run2_18Sv4_asv %>%
left_join(run2_18Sv4_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run2_18Sv4_merge
run2_18Sv4_merge
run2_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run2_18Sv4_long
run2_18Sv4_long
bind_rows(run2_18Sv4_long, run3_18Sv4_long) -> long_18Sv4_EcoFOCI
saveRDS(long_18Sv4_EcoFOCI, here("data","long_data","long_18Sv4_EcoFOCI.RDS"))
run2_18Sv9_asv <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","18Sv9","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run2_18Sv9_tax <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","18Sv9","ASV2Taxonomy","18Sv9_RUN1_asvTaxonomyTable.txt"), sep="\t", header=T) #IS IT REALLY CALLED RUN1 when it is RUN2?
run2_18Sv9_asv %>%
left_join(run2_18Sv9_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run2_18Sv9_merge
run2_18Sv9_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run2_18Sv9_long
run2_18Sv9_long
run3_18Sv9_asv <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv9_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run3_18Sv9_tax <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","18Sv9_REVAMP_out","ASV2Taxonomy","18Sv9_REVAMP_out_asvTaxonomyTable.txt"), sep="\t", header=T)
run3_18Sv9_asv %>%
left_join(run3_18Sv9_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run3_18Sv9_merge
run3_18Sv9_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run3_18Sv9_long
run3_18Sv9_long
bind_rows(run2_18Sv9_long, run3_18Sv9_long) -> long_18Sv9_EcoFOCI
saveRDS(long_18Sv9_EcoFOCI, here("data","long_data","long_18Sv9_EcoFOCI.RDS"))
run1_18Sv4_asv <- read.table(here("data","REVAMP_out","run1_from_poseidon_20250103","18Sv4","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run1_18Sv4_asv <- read.table(here("data","REVAMP_out","run1_from_poseidon_20250103","18Sv4","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run1_18Sv4_long
run1_18Sv4_asv
run1_18Sv4_tax
run1_18Sv4_tax <- read.table(here("data","REVAMP_out","run1_from_poseidon_20250103","18Sv4","ASV2Taxonomy","18Sv4_RUN1_asvTaxonomyTable.txt"), sep="\t", header=T) #IS IT REALLY CALLED RUN1 when it is run1?
run1_18Sv4_tax <- read.table(here("data","REVAMP_out","run1_from_poseidon_20250103","18Sv4","ASV2Taxonomy","18Sv4_RUN2_asvTaxonomyTable.txt"), sep="\t", header=T) #IS IT REALLY CALLED RUN2 when it is run1?
run1_18Sv4_tax <- read.table(here("data","REVAMP_out","run1_from_poseidon_20250103","18Sv4","ASV2Taxonomy","18Sv4_RUN2_sansPOS_asvTaxonomyTable.txt"), sep="\t", header=T) #IS IT REALLY CALLED RUN2 when it is run1?
run1_18Sv4_asv %>%
left_join(run1_18Sv4_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run1_18Sv4_merge
run1_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run1_18Sv4_long
run1_18Sv4_asv %>%
left_join(run1_18Sv4_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run1_18Sv4_merge
run1_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run1_18Sv4_long
run1_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name))
run1_18Sv4_merge
run1_4_revamp_formatted_metadata %>%
filter(., str_detect(Sample, "E373"))
run1_18Sv4_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata)
run2_COI_asv <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","COI","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run2_COI_tax <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","COI","ASV2Taxonomy","COI_RUN1_asvTaxonomyTable.txt"), sep="\t", header=T) #IS IT REALLY CALLED RUN1 when it is RUN2?
run2_COI_asv %>%
left_join(run2_COI_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run2_COI_merge
run2_COI_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run2_COI_long
run2_COI_long
run3_COI_asv <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","COI_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run3_COI_tax <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","COI_REVAMP_out","ASV2Taxonomy","COI_REVAMP_out_asvTaxonomyTable.txt"), sep="\t", header=T)
run3_COI_asv %>%
left_join(run3_COI_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run3_COI_merge
run3_COI_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run3_COI_long
bind_rows(run2_COI_long, run3_COI_long) -> long_COI_EcoFOCI
saveRDS(long_COI_EcoFOCI, here("data","long_data","long_COI_EcoFOCI.RDS"))
run2_MiFish_asv <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","MiFish","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run2_MiFish_tax <- read.table(here("data","REVAMP_out","Run2_from_poseidon_20250103","MiFish","ASV2Taxonomy","MiFish_RUN1_asvTaxonomyTable.txt"), sep="\t", header=T) #IS IT REALLY CALLED RUN1 when it is RUN2?
run2_MiFish_asv %>%
left_join(run2_MiFish_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run2_MiFish_merge
run2_MiFish_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run2_MiFish_long
run3_MiFish_asv <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","MiFish_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
rename(ASV=x)
run3_MiFish_tax <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","MiFish_REVAMP_out","ASV2Taxonomy","MiFish_REVAMP_out_asvTaxonomyTable.txt"), sep="\t", header=T)
run3_MiFish_asv %>%
left_join(run3_MiFish_tax) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run3_MiFish_merge
run3_MiFish_merge %>%
pivot_longer(cols = c(-ASV, -Kingdom, -Phylum, -Class, -Order, -Family,-Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run3_MiFish_long
bind_rows(run2_MiFish_long, run3_MiFish_long) -> long_MiFish_EcoFOCI
saveRDS(long_MiFish_EcoFOCI, here("data","long_data","long_MiFish_EcoFOCI.RDS"))
