filter(., PA >1) %>%
ggplot(., aes(, x=Temp_C)) +geom_density() + facet_wrap(Species~.)
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
filter(., PA >0) %>%
ggplot(., aes(, x=Temp_C)) +geom_density() + facet_wrap(Species~.)
long_COI_EcoFOCI %>%
group_by(Sample) %>%
mutate(Tot = sum(nReads)) %>%
filter(., Genus=="Pseudocalanus") %>%
filter(., !is.na(Species)) %>%
group_by(!!!syms(varnames_to_group)) %>%
dplyr::summarise(nReads=sum(nReads)) %>%
mutate (Prop.abund = nReads / Tot) %>%
ungroup() %>%
group_by (Species) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
mutate(., Type = case_when(Species == "Pseudocalanus mimus" ~ "Temperate",
Species == "Pseudocalanus newmani"~ "Temperate",
Species ==  "Pseudocalanus minutus" ~"Arctic",
Species ==  "Pseudocalanus acuspes" ~"Arctic",
Species ==  "Pseudocalanus moultoni" ~"Temperate",
TRUE ~"Unknown"))
long_COI_EcoFOCI %>%
group_by(Sample) %>%
mutate(Tot = sum(nReads)) %>%
filter(., Genus=="Pseudocalanus") %>%
filter(., !is.na(Species)) %>%
group_by(!!!syms(varnames_to_group)) %>%
dplyr::summarise(nReads=sum(nReads)) %>%
mutate (Prop.abund = nReads / Tot) %>%
ungroup() %>%
group_by (Species) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
mutate(., Type = case_when(Species == "Pseudocalanus mimus" ~ "Temperate",
Species == "Pseudocalanus newmani"~ "Temperate",
Species ==  "Pseudocalanus minutus" ~"Arctic",
Species ==  "Pseudocalanus acuspes" ~"Arctic",
Species ==  "Pseudocalanus moultoni" ~"Temperate",
TRUE ~"Unknown"))-> Pseudocalanus_Df
Pseudocalanus_Df
Pseudocalanus_Df %>%
ggplot(., aes(y=eDNA.Index, x=Temp_C)) +geom_point() + facet_wrap(Species~.)
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
ggplot(., aes(y=PA, x=Temp_C)) +geom_point() + facet_wrap(Species~Type) +
geom_smooth(method = "glm",
method.args = list(family = "binomial"),
se = FALSE)
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
ggplot(., aes(y=OxyConc_umol.per.l, x=Temp_C, colour = PA)) +geom_point() + facet_wrap(Species~.)
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
ggplot(., aes(y=PSU_ppt, x=Temp_C, colour = eDNA.Index)) +geom_point() + facet_wrap(Species~Type) +    scale_color_gradientn(colours = c("black", "#C6DBEF", 'dodgerblue4'),
values = c(0, .Machine$double.eps, 1))
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
filter(., PA >0) %>%
ggplot(., aes(, x=Temp_C)) +geom_density() + facet_wrap(Species~.)
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
filter(., PA >0) %>%
ggplot(., aes(, x=Temp_C)) +geom_density() + facet_wrap(Species~Type)
Pseudocalanus_Df %>%
ggplot(., aes(y=nReads, x=Temp_C)) +geom_point() + facet_wrap(Species~.)
Pseudocalanus_Df %>%
ggplot(., aes(y=log10(nReads), x=Temp_C)) +geom_point() + facet_wrap(Species~.)
Pseudocalanus_Df %>%
ggplot(., aes(y=log10(nReads), x=Temp_C)) +geom_point() + facet_wrap(Species~Type)
Pseudocalanus_Df
Pseudocalanus_Df %>%
ggplot(., aes(y=log10(nReads), x=Temp_C, color=Cruise_ID_short)) +geom_point() + facet_wrap(Species~Type)
Pseudocalanus_Df %>%
filter(., Cruise_ID_short=="SKQ23-12S") %>%
ggplot(., aes(y=log10(nReads), x=Temp_C, color=Cruise_ID_short)) +geom_point() + facet_wrap(Species~Type)
Pseudocalanus_Df %>%
filter(., Cruise_ID_short=="SKQ23-12S")
filter(., Cruise_ID_short=="SKQ23-12S")
long_COI_EcoFOCI %>%
filter(., Cruise_ID_short=="SKQ23-12S")
library(tidyverse)
library(readxl)
library(here)
library(readr)
revamp_format_run1_4 <- read_excel(here("data","20241218_analysis","sample_metadata_smm_20241218.xlsx"))
revamp_format_run1_4 <- read_excel(here("20241218_analysis","sample_metadata_smm_20241218.xlsx"))
revamp_format_run1_4 <- read_excel(here("data","20241218_analysis","sample_metadata_smm_20241218.xlsx"))
FinalOME_Merge_DY20_12 <- read.csv(file = here("data","1_SampleCollection","2020_DY20-12_CruiseData","2020_Dyson_CruiseData","FinalOME_Merge_DY20-12.csv"), header=T)
FinalOME_Merge_NO20_01 <-  read.csv(here("data","1_SampleCollection","2020_NO20-01_CruiseData","FinalOME_Merge_NO20-01.csv"), header=T)
FinalOME_Merge_SKQ21_12S <- read.csv(file = here("data","1_SampleCollection","2021_SikuliaqDBO_CruiseData","2021_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ21-12S.csv"), header=T)
FinalOME_Merge_DY22_09 <- read.csv(here("data","1_SampleCollection","2022_DY22-09_CruiseData","FinalOME_Merge_DY22-09.csv"), header=T)
FinalOME_Merge_DY22_06 <- read.csv(here("data","1_SampleCollection","2022_DY22-06_CruiseData","FinalOME_Merge_DY22-06.csv"), header=T)
FinalOME_Merge_RC0083 <- read.csv(here("data","1_SampleCollection","2022_GOA-OA_CruiseData","FinalOME_Merge_RC0083.csv"), header=T)
FinalOME_Merge_DY23_06 <- read.csv(here("data","1_SampleCollection","2023_EcoFociSpringMooring_CruiseData","FinalOME_Merge_DY23-06.csv"), header=T)
FinalOME_Merge_M2_PPS_0523 <- read.csv(here("data","1_SampleCollection","2023_M2_Spring-Summer_CruiseData","FinalOME_Merge_M2-PPS-0523.csv"), header=T)
FinalOME_Merge_SKQ23_12S <- read.csv(here("data","1_SampleCollection","2023_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ23-12S.csv"), header=T)
FinalOME_Merge_AquaM_23 <- read.csv(here("data","1_SampleCollection","2023_aquamonitor_CruiseData","FinalOME_Merge_AquaM_23.csv"), header=T)
c(colnames(FinalOME_Merge_DY20_12),
colnames(FinalOME_Merge_NO20_01),
colnames(FinalOME_Merge_SKQ21_12S),
colnames(FinalOME_Merge_DY22_09),
colnames(FinalOME_Merge_DY22_06),
colnames(FinalOME_Merge_RC0083),
colnames(FinalOME_Merge_DY23_06),
colnames(FinalOME_Merge_M2_PPS_0523),
colnames(FinalOME_Merge_SKQ23_12S),
colnames(FinalOME_Merge_AquaM_23)) %>% unique() -> all_unique
FinalOME_Merge_SKQ23_12S %>%
mutate(., ctd_latitude..degrees_north. = if_else(is.na(ctd_latitude..degrees_north.), Lat_notes,ctd_latitude..degrees_north.)) %>%
mutate(., ctd_longitude..degrees_east. = if_else(is.na(ctd_longitude..degrees_east.), Lon_notes,ctd_longitude..degrees_east.)) %>%
mutate(., ctd_pressure = if_else(is.na(ctd_pressure), Depth_m_notes,ctd_pressure)) %>%
mutate(., ctd_time..UTC. = if_else(is.na(ctd_time..UTC.), str_c(Date_UTC_notes,"Z"),ctd_time..UTC.)) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.," ", "T")) %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= ctd_temperature_ch1..degree_C.,
PSU_ppt = ctd_salinity_ch1..PSU.,
OxySatPerc_percent = ctd_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = ctd_oxy_conc_ch1..umol.kg.,
Chla_ugrams.per.l = ctd_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_SKQ23_12S
REVAMP_SKQ23_12S
FinalOME_Merge_DY20_12 %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= ctd_temperature_ch1..degree_C.,
PSU_ppt = ctd_salinity_ch1..PSU.,
OxySatPerc_percent = ctd_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = ctd_oxy_conc_ch1..umol.kg.,
Chla_ugrams.per.l = ctd_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_DY20_12
FinalOME_Merge_SKQ21_12S %>%
#For some reason we are missing the first bottle file for this cruise... so taking time and lat/lon data from notes
mutate(., ctd_latitude..degrees_north. = if_else(Cast_No.==1, Lat_notes,ctd_latitude..degrees_north.)) %>%
mutate(., ctd_longitude..degrees_east. = if_else(Cast_No.==1, Lon_notes,ctd_longitude..degrees_east.)) %>%
mutate(., ctd_pressure = if_else(Cast_No.==1, Depth_m_notes,ctd_pressure)) %>%
mutate(., ctd_time..UTC. = if_else(Cast_No.==1, Date_UTC_notes,ctd_time..UTC.)) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.,"08 22", "08T22")) %>%
mutate(ctd_time..UTC. = if_else(Cast_No.==1, str_c(ctd_time..UTC.,"Z"),ctd_time..UTC.)) %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= ctd_temperature_ch1..degree_C.,
PSU_ppt = ctd_salinity_ch1..PSU.,
OxySatPerc_percent = ctd_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = ctd_oxy_conc_ch1..umol.kg.,
Chla_ugrams.per.l = ctd_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_SKQ21_12S
FinalOME_Merge_DY22_09 %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= ctd_temperature_ch1..degree_C.,
PSU_ppt = ctd_salinity_ch1..PSU.,
OxySatPerc_percent = ctd_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = ctd_oxy_conc_ch1..umol.kg.,
Chla_ugrams.per.l = ctd_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_DY22_09
FinalOME_Merge_SKQ23_12S %>%
mutate(., ctd_latitude..degrees_north. = if_else(is.na(ctd_latitude..degrees_north.), Lat_notes,ctd_latitude..degrees_north.)) %>%
mutate(., ctd_longitude..degrees_east. = if_else(is.na(ctd_longitude..degrees_east.), Lon_notes,ctd_longitude..degrees_east.)) %>%
mutate(., ctd_pressure = if_else(is.na(ctd_pressure), Depth_m_notes,ctd_pressure)) %>%
mutate(., ctd_time..UTC. = if_else(is.na(ctd_time..UTC.), str_c(Date_UTC_notes,"Z"),ctd_time..UTC.)) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.," ", "T")) %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= ctd_temperature_ch1..degree_C.,
PSU_ppt = ctd_salinity_ch1..PSU.,
OxySatPerc_percent = ctd_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = ctd_oxy_conc_ch1..umol.kg.,
Chla_ugrams.per.l = ctd_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_SKQ23_12S
REVAMP_SKQ23_12S
FinalOME_Merge_DY22_06 %>%
mutate(., ctd_latitude..degrees_north. = if_else(is.na(ctd_latitude..degrees_north.), btl_latitude..degrees_north.,ctd_latitude..degrees_north.)) %>%
mutate(., ctd_longitude..degrees_east. = if_else(is.na(ctd_longitude..degrees_east.), btl_longitude..degrees_east.,ctd_longitude..degrees_east.)) %>%
mutate(., ctd_pressure = if_else(is.na(ctd_pressure), btl_pressure..decibar.,ctd_pressure)) %>%
mutate(., ctd_pressure = if_else(is.na(ctd_pressure), Depth_m_notes,ctd_pressure)) %>%
mutate(., ctd_time..UTC. = if_else(is.na(ctd_time..UTC.), btl_time..UTC.,ctd_time..UTC.)) %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=ctd_pressure,
lat=ctd_latitude..degrees_north.,
lon = ctd_longitude..degrees_east.,
Temp_C= btl_temperature_ch1..degree_C.,
PSU_ppt = btl_salinity_ch1..PSU.,
OxySatPerc_percent = btl_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = btl_oxy_conc_ch1..micromole.kg.,
Chla_ugrams.per.l = btl_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = ctd_PO4..uM.l.,
NO2_umol.per.l=ctd_NO2..uM.l.,
NO3_umol.per.l=ctd_NO3..uM.l.,
NH4_umol.per.l =ctd_NH4..uM.l.) -> REVAMP_DY22_06
# Norseman2020_long
FinalOME_Merge_NO20_01 %>%
mutate(., ctd_time..UTC. = str_replace_all(Date_UTC_btl,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.," ", "T")) %>%
mutate(ctd_time..UTC. = str_c(ctd_time..UTC.,"Z"),ctd_time..UTC.) %>%
mutate(., OxySatPerc_percent= NA) %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=btl_Pressure.db.,
lat=btl_Latitude,
lon = btl_Longitude,
Temp_C= btl_Temperature.deg.C.,
PSU_ppt = btl_Salinity.psu.,
OxySatPerc_percent = OxySatPerc_percent,
OxyConc_umol.per.l = btl_Oxygen.umol.kg.,
Chla_ugrams.per.l = btl_Fluorescence.mg.m.3.,
PO4_umol.per.l = btl_phosphate.µM,
NO2_umol.per.l=btl_nitrate.nitriteµM,
NO3_umol.per.l=btl_nitrate.nitriteµM,
NH4_umol.per.l =btl_ammonia) -> REVAMP_NO20_01
#RCGOA2022_long
#  carbonate chemistry not included since no other cruise has that data as of 12/26/2024
FinalOME_Merge_RC0083  %>%
mutate(., ctd_time..UTC. = str_replace_all(Date_UTC_btl,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.," ", "T")) %>%
mutate(ctd_time..UTC. = str_c(ctd_time..UTC.,"Z"),ctd_time..UTC.) %>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=btl2_CTDPRES,
lat=btl2_Latitude,
lon = btl2_Longitude,
Temp_C= btl2_CTDTEMP_ITS90,
PSU_ppt = btl2_CTDSAL_PSS78,
OxySatPerc_percent = btl_Sbeox0PS,
OxyConc_umol.per.l = btl_Sbox0Mm.Kg,
Chla_ugrams.per.l = btl_FlECO.AFL,
PO4_umol.per.l = btl2_Phosphate.umol.kg.1,
NO2_umol.per.l=btl2_Nitrite.umol.kg.1,
NO3_umol.per.l=btl2_Nitrate.umol.kg.1,
NH4_umol.per.l =btl2_Ammonium.umol.kg.1) -> REVAMP_RC0083
#This is also missing a bunch of cast data, Shaun said he would send the processed, raw data is missing casts for whatever reason
#DY23_06
FinalOME_Merge_DY23_06 %>%
mutate(., btl_latitude..degrees_north. = if_else(is.na(btl_time..UTC.), Lat_notes,btl_latitude..degrees_north.)) %>%
mutate(., btl_longitude..degrees_east. = if_else(is.na(btl_time..UTC.), Lon_notes,btl_longitude..degrees_east.)) %>%
mutate(., btl_pressure..decibar. = if_else(is.na(btl_time..UTC.), Depth_m_notes,btl_pressure..decibar.)) %>%
mutate(., btl_time..UTC. = if_else(is.na(btl_time..UTC.), str_c(Date_UTC_notes,"Z"),btl_time..UTC.)) %>%
mutate(., btl_time..UTC. = str_replace_all(btl_time..UTC.,"\\/", "-")) %>%
mutate(., btl_time..UTC. = str_replace_all(btl_time..UTC.," ", "T")) %>%
mutate(.,PO4_umol.per.l = NA,
NO2_umol.per.l=NA,
NO3_umol.per.l=NA,
NH4_umol.per.l =NA)%>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=btl_time..UTC.,
Depth_m=btl_pressure..decibar.,
lat=btl_latitude..degrees_north.,
lon = btl_longitude..degrees_east.,
Temp_C= btl_temperature_ch2..degree_C.,
PSU_ppt = btl_salinity_ch1..PSU.,
OxySatPerc_percent = btl_oxy_percentsat_ch1..percent.,
OxyConc_umol.per.l = btl_oxy_conc_ch1..micromole.kg.,
Chla_ugrams.per.l = btl_chlor_fluorescence..ugrams.l.,
PO4_umol.per.l = PO4_umol.per.l,
NO2_umol.per.l=NO2_umol.per.l,
NO3_umol.per.l=NO3_umol.per.l,
NH4_umol.per.l =NH4_umol.per.l) -> REVAMP_DY23_06
FinalOME_Merge_M2_PPS_0523 %>%
mutate(., ctd_time..UTC. = str_replace_all(Date_UTC_notes,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.," ", "T")) %>%
mutate(ctd_time..UTC. = str_c(ctd_time..UTC.,"Z"),ctd_time..UTC.) %>%
mutate(.,
Temp_C= NA,
PSU_ppt = NA,
OxySatPerc_percent = NA,
OxyConc_umol.per.l = NA,
Chla_ugrams.per.l = NA,
PO4_umol.per.l = NA,
NO2_umol.per.l=NA,
NO3_umol.per.l=NA,
NH4_umol.per.l =NA)%>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=Depth_m_notes,
lat=Lat_notes,
lon = Lon_notes,
Temp_C= Temp_C,
PSU_ppt = PSU_ppt,
OxySatPerc_percent = OxySatPerc_percent,
OxyConc_umol.per.l = OxyConc_umol.per.l,
Chla_ugrams.per.l = Chla_ugrams.per.l,
PO4_umol.per.l = PO4_umol.per.l,
NO2_umol.per.l=NO2_umol.per.l,
NO3_umol.per.l=NO3_umol.per.l,
NH4_umol.per.l =NH4_umol.per.l) -> REVAMP_PPS_0523
FinalOME_Merge_AquaM_23 %>%
mutate(., ctd_time..UTC. = str_replace_all(Date_UTC_notes,"\\/", "-")) %>%
mutate(., ctd_time..UTC. = str_replace_all(ctd_time..UTC.," ", "T")) %>%
mutate(ctd_time..UTC. = str_c(ctd_time..UTC.,"Z"),ctd_time..UTC.) %>%
mutate(.,
Temp_C= NA,
PSU_ppt = NA,
OxySatPerc_percent = NA,
OxyConc_umol.per.l = NA,
Chla_ugrams.per.l = NA,
PO4_umol.per.l = NA,
NO2_umol.per.l=NA,
NO3_umol.per.l=NA,
NH4_umol.per.l =NA)%>%
dplyr::select(Sample_Name, Biological_Replicate, Technical_Replicate, Negative_control, Cruise_ID_short, Cruise_ID_long, Cast_No.,Rosette_position, Station, Sample_volume_ml,
Time=ctd_time..UTC.,
Depth_m=Depth_m_notes,
lat=Lat_notes,
lon = Lon_notes,
Temp_C= Temp_C,
PSU_ppt = PSU_ppt,
OxySatPerc_percent = OxySatPerc_percent,
OxyConc_umol.per.l = OxyConc_umol.per.l,
Chla_ugrams.per.l = Chla_ugrams.per.l,
PO4_umol.per.l = PO4_umol.per.l,
NO2_umol.per.l=NO2_umol.per.l,
NO3_umol.per.l=NO3_umol.per.l,
NH4_umol.per.l =NH4_umol.per.l) -> REVAMP_AquaM_23
rbind(REVAMP_DY20_12, REVAMP_DY22_06, REVAMP_DY22_09, REVAMP_DY23_06, REVAMP_NO20_01, REVAMP_PPS_0523, REVAMP_RC0083, REVAMP_SKQ21_12S, REVAMP_SKQ23_12S, REVAMP_AquaM_23) -> revamp_sample_metadata
revamp_sample_metadata %>%
filter(., str_detect(Sample_Name,"E2084"))
revamp_format_run1_4 %>%
dplyr::select(-sites, -lat, -long) %>%
mutate(., Sample_Name = str_replace(Sample,"_","\\.")) %>%
mutate(.,Sample_Name = str_remove(Sample_Name,"_PCR1|_PCR2|_PCR3")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_NO20",".NO20")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"_DY20",".DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"E26.1B.DY2012","E26.1B.NC.DY2012")) %>%
mutate(.,Sample_Name = str_replace(Sample_Name,"E44.DY20","E44.DY2012")) %>%
left_join(revamp_sample_metadata) %>%
mutate(., sites = Station) -> run1_4_revamp_formatted_metadata
readr::write_excel_csv(run1_4_revamp_formatted_metadata, file="run1_4_revamp_formatted_metadata.csv")
run1_4_revamp_formatted_metadata
run1_4_revamp_formatted_metadata %>%
filter(., Cruise_ID_short=="SKQ23-12S")
readr::write_excel_csv(run1_4_revamp_formatted_metadata, file="run1_4_revamp_formatted_metadata.csv")
run1_4_revamp_formatted_metadata <- read.csv(here("run1_4_revamp_formatted_metadata.csv"))
run1_4_revamp_formatted_metadata %>%
filter(., str_detect(Sample, "E2084_SKQ23_12S"))
run1_4_revamp_formatted_metadata
run1_4_revamp_formatted_metadata %>%
filter(., str_detect(Sample, "E2084_SKQ23_12S"))
run1_4_revamp_formatted_metadata %>%
filter(., Cruise_ID_short=="SKQ23-12S")
long_COI_EcoFOCI %>%
filter(., Cruise_ID_short=="SKQ23-12S") %>%
filter(., !is.na(NH4_umol.per.l))
long_COI_EcoFOCI %>%
filter(., Cruise_ID_short=="SKQ23-12S")
run1_4_revamp_formatted_metadata %>%
filter(., str_detect(Sample, "E2084_SKQ23_12S"))
long_COI_EcoFOCI %>%
filter(., Cruise_ID_short=="SKQ23-12S")
long_COI_EcoFOCI %>%
filter(., Cruise_ID_short=="SKQ23-12S") %>%
dplyr::select(Sample) %>%  distin()
long_COI_EcoFOCI %>%
filter(., Cruise_ID_short=="SKQ23-12S") %>%
dplyr::select(Sample) %>%  distinct()
long_COI_EcoFOCI %>%
filter(., Cruise_ID_short=="SKQ23-12S") %>%
ungroup() %>%
dplyr::select(Sample) %>%  distinct()
run3_COI_asv <- read.table(here("data","REVAMP_out","Run3_from_poseidon_20250103","COI_REVAMP_out","dada2","ASVs_counts.tsv"), sep="\t", header=T) %>%
dplyr::rename(ASV=x)
run3_COI_asv %>%
dplyr::rename(`Run3:ASV`=ASV) %>%
left_join(run2_3_COI_united_ASV_tables) %>%
rename_at(vars(starts_with("MP_")), funs(str_replace(., "MP_", ""))) -> run3_COI_merge
run3_COI_merge %>%
pivot_longer(cols = c(-`ASV_combo`, -`Run2:ASV`, -`Run3:ASV`,-`Sequence`,-Kingdom, -Phylum, -Class, -Order, -Family, -Genus, -Species), names_to = "Sample", values_to = "nReads") %>%
left_join(run1_4_revamp_formatted_metadata) %>%
filter(., !is.na(Sample_Name)) %>% # this removes all non-EcoFOCI samples. Note this also excludes positive and negative controls. No decontamination has been performed. We should definitely do this at somepoint, but need a conversation as to what approaches
group_by(Sample) %>%
mutate (Tot = sum(nReads),
Prop.abund = nReads / Tot) %>%
group_by (ASV_combo) %>%
mutate (Colmax = max(Prop.abund),
eDNA.Index = Prop.abund / Colmax) %>%
dplyr::select(-Tot,-Colmax) -> run3_COI_long
run3_COI_long
run3_COI_long %>%
filter(., Cruise_ID_short=="SKQ23-12S") %>%
ungroup() %>%
dplyr::select(Sample) %>%  distinct()
run3_COI_asv
colnames(run3_COI_asv)
Pseudocalanus_Df %>%
ggplot(., aes(y=log10(nReads), x=Temp_C, color=Cruise_ID_short)) +geom_point() + facet_wrap(Species~Type)
library(tidyverse)
library(readxl)
library(here)
library(readr)
revamp_format_run1_4 <- read_excel(here("data","20241218_analysis","sample_metadata_smm_20241218.xlsx"))
FinalOME_Merge_DY20_12 <- read.csv(file = here("data","1_SampleCollection","2020_DY20-12_CruiseData","2020_Dyson_CruiseData","FinalOME_Merge_DY20-12.csv"), header=T)
FinalOME_Merge_NO20_01 <-  read.csv(here("data","1_SampleCollection","2020_NO20-01_CruiseData","FinalOME_Merge_NO20-01.csv"), header=T)
FinalOME_Merge_SKQ21_12S <- read.csv(file = here("data","1_SampleCollection","2021_SikuliaqDBO_CruiseData","2021_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ21-12S.csv"), header=T)
FinalOME_Merge_DY22_09 <- read.csv(here("data","1_SampleCollection","2022_DY22-09_CruiseData","FinalOME_Merge_DY22-09.csv"), header=T)
FinalOME_Merge_DY22_06 <- read.csv(here("data","1_SampleCollection","2022_DY22-06_CruiseData","FinalOME_Merge_DY22-06.csv"), header=T)
FinalOME_Merge_RC0083 <- read.csv(here("data","1_SampleCollection","2022_GOA-OA_CruiseData","FinalOME_Merge_RC0083.csv"), header=T)
FinalOME_Merge_DY23_06 <- read.csv(here("data","1_SampleCollection","2023_EcoFociSpringMooring_CruiseData","FinalOME_Merge_DY23-06.csv"), header=T)
FinalOME_Merge_M2_PPS_0523 <- read.csv(here("data","1_SampleCollection","2023_M2_Spring-Summer_CruiseData","FinalOME_Merge_M2-PPS-0523.csv"), header=T)
FinalOME_Merge_SKQ23_12S <- read.csv(here("data","1_SampleCollection","2023_SikuliaqDBO_CruiseData","FinalOME_Merge_SKQ23-12S.csv"), header=T)
FinalOME_Merge_AquaM_23 <- read.csv(here("data","1_SampleCollection","2023_aquamonitor_CruiseData","FinalOME_Merge_AquaM_23.csv"), header=T)
c(colnames(FinalOME_Merge_DY20_12),
colnames(FinalOME_Merge_NO20_01),
colnames(FinalOME_Merge_SKQ21_12S),
colnames(FinalOME_Merge_DY22_09),
colnames(FinalOME_Merge_DY22_06),
colnames(FinalOME_Merge_RC0083),
colnames(FinalOME_Merge_DY23_06),
colnames(FinalOME_Merge_M2_PPS_0523),
colnames(FinalOME_Merge_SKQ23_12S),
colnames(FinalOME_Merge_AquaM_23)) %>% unique() -> all_unique
all_unique %>%  as.tibble() %>%
mutate(., SKQ21 = if_else(value %in% colnames(FinalOME_Merge_SKQ21_12S), value, NA),
DY2020 = if_else(value %in% colnames(FinalOME_Merge_DY20_12), value, NA),
DY2206_long = if_else(value %in% colnames(FinalOME_Merge_DY22_06), value, NA),
DY2209_long = if_else(value %in% colnames(FinalOME_Merge_DY22_09), value, NA),
Norseman2020_long = if_else(value %in% colnames(FinalOME_Merge_NO20_01), value, NA),
RCGOA2022_long = if_else(value %in% colnames(FinalOME_Merge_RC0083), value, NA),
M2_PPS_0523 = if_else(value %in% colnames(FinalOME_Merge_M2_PPS_0523), value, NA),
DY23_06 = if_else(value %in% colnames(FinalOME_Merge_DY23_06), value, NA),
SKQ202312S_long = if_else(value %in% colnames(FinalOME_Merge_SKQ23_12S), value, NA),
AquaM_23 = if_else(value %in% colnames(FinalOME_Merge_AquaM_23), value, NA) ) -> tibble_of_columns
tibble_of_columns
tibble_of_columns %>%
filter(., str_detect(value,"temperature|temp|T090C|T190C|Temp|Temperature"))
Pseudocalanus_Df
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
mutate(., Time2 = as.POSIXct.Date(Time))
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
mutate(., Time2 = as.POSIXct(Time))
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
mutate(., Time2 = as.POSIXct(Time)) %>%
ggplot(., aes(x=Time2, y=Temp_C, colour = eDNA.Index)) +geom_point() + facet_wrap(Species~Type) +    scale_color_gradientn(colours = c("black", "#C6DBEF", 'dodgerblue4'),
values = c(0, .Machine$double.eps, 1))
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
mutate(., Time2 = as.POSIXct(Time)) %>%
ggplot(., aes(x=Time2, y=Temp_C, colour = eDNA.Index)) +geom_point() + facet_wrap(Species~Type) +    scale_color_gradientn(colours = c("grey80", "#C6DBEF", 'dodgerblue4'),
values = c(0, .Machine$double.eps, 1))
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
mutate(., Time2 = as.POSIXct(Time)) %>%
ggplot(., aes(x=Time2, y=Temp_C, colour = eDNA.Index)) +geom_point() + facet_wrap(Species~Type) +    scale_color_gradientn(colours = c("grey80", "#C6DBEF", 'dodgerblue4'),
values = c(0, .Machine$double.eps, 1)) +theme_bw()
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
mutate(., Time2 = as.POSIXct(Time)) %>%
ggplot(., aes(x=Time2, y=Temp_C, colour = eDNA.Index)) +geom_point() + facet_wrap(Species~Type) +    scale_color_gradientn(colours = c("grey80", "yellow", 'dodgerblue4'),
values = c(0, .Machine$double.eps, 1)) +theme_bw()
Pseudocalanus_Df %>%
mutate(., PA = if_else(nReads >0, 1,0)) %>%
mutate(., Time2 = as.POSIXct(Time)) %>%
ggplot(., aes(x=Time2, y=Temp_C, colour = eDNA.Index)) +geom_point() + facet_wrap(Species~Type) +    scale_color_gradientn(colours = c("grey80", "lightyellow", 'red'),
values = c(0, .Machine$double.eps, 1)) +theme_bw()
Pseudocalanus_Df %>%
filter(. Species =="Pseudocalanus mimus") %>%
Pseudocalanus_Df %>%
filter(., Species =="Pseudocalanus mimus") %>%
ggplot(., aes(y=eDNA.Index, x=Temp_C)) +geom_point() + facet_wrap(Species~.)
Pseudocalanus_Df %>%
filter(., Species =="Pseudocalanus mimus") %>%
ggplot(., aes(y=eDNA.Index, x=Temp_C)) +geom_point() + facet_wrap(Species~.) +
stat_poly_line() +
stat_poly_eq() +
geom_point()
library(ggpmisc)
install.packages("ggpmisc")
library(ggpmisc)
library(Matrix, lib.loc = "/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library")
install.packages("Matrix")
library(ggpmisc)
detach("package:Matrix", unload = TRUE)
install.packages('ggpmisc', dependencies = TRUE)
sessionInfo()
